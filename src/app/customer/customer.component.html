<div class="container">
  <app-menus></app-menus>
  <mat-card>
    <div class="mat-card-header">
      <h3>Lista de clientes</h3>
      <button mat-raised-button color="primary" (click)="openCustomerDialog()">Nuevo Cliente</button>
    </div>
    <div class="mat-card-content">
      <ngx-datatable
        class="bootstrap"
        [rows]="dataSource"
        [columns]="columns"
        [columnMode]="'force'"
        [headerHeight]="50"
        [footerHeight]="50"
        [rowHeight]="'auto'">
        
        <ngx-datatable-column *ngFor="let column of columns" [prop]="column.prop" [name]="column.name">
          <ng-template ngx-datatable-cell-template let-row="row">
            <ng-container *ngIf="column.prop === 'actions'; else defaultTemplate">
              <ng-container *ngTemplateOutlet="actionTemplate; context: { $implicit: row }"></ng-container>
            </ng-container>
            <ng-template #defaultTemplate>
              {{ row[column.prop] }}
            </ng-template>
          </ng-template>
        </ngx-datatable-column>

      </ngx-datatable>
    </div>
  </mat-card>

  <!-- Template para las acciones -->
  <ng-template #actionTemplate let-row="row">
    <button mat-icon-button color="primary" (click)="updateCustomer(row)">
      <mat-icon>edit</mat-icon>
    </button>
    <button mat-icon-button color="warn" (click)="deleteCustomer(row)">
      <mat-icon>delete</mat-icon>
    </button>
  </ng-template>

  <!-- Modal para añadir cliente -->
  <ng-template #customerDialog>
    <h4 mat-dialog-title>Añadir cliente</h4>
    <form #customerForm="ngForm" (ngSubmit)="createCustomer(customerForm.value)">
      <mat-form-field appearance="fill">
        <mat-label>Nombre</mat-label>
        <input matInput type="text" name="name" id="name" required ngModel />
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Teléfono</mat-label>
        <input matInput type="number" name="mobile" id="mobile" required ngModel />
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Balance</mat-label>
        <input matInput type="number" name="balance" id="balance" required ngModel />
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Dirección</mat-label>
        <textarea matInput name="address" id="address" rows="5" required ngModel></textarea>
      </mat-form-field>
      <div mat-dialog-actions>
        <button mat-button type="submit" color="primary">Guardar</button>
        <button mat-button type="button" (click)="dialogRef.close()">Cerrar</button>
      </div>
    </form>
  </ng-template>
</div>
